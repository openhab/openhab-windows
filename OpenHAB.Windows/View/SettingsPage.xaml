<Page x:Class="OpenHAB.Windows.View.SettingsPage"
	  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	  xmlns:converters="using:OpenHAB.Windows.Converters"
	  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	  xmlns:Interactivity="using:Microsoft.Xaml.Interactivity"
	  xmlns:Core="using:Microsoft.Xaml.Interactions.Core"
	  xmlns:community="using:Microsoft.Toolkit.Uwp.UI.Controls"
	  mc:Ignorable="d">

	<Page.Background>
		<ImageBrush ImageSource="/Assets/background.jpg"
					Stretch="UniformToFill" />
	</Page.Background>
	<Page.Resources>
		<converters:ReverseBoolConverter x:Key="ReverseBoolConverter" />
		<converters:OpenHabUrlStateToGlyph x:Key="OpenHabUrlStateToGlyph" />

		<DataTemplate x:Key="ConnectionConfigTemplate">
			<StackPanel Margin="0,0,10,0">
				<TextBlock x:Uid="ConnectionProfile" />
				<ComboBox Margin="0,0,12,12"
						  ItemsSource="{Binding}"
						  SelectedItem="{Binding Profile, Mode=TwoWay}"  />
				<TextBlock x:Uid="LocalUrlHeader" />
				<TextBox x:Uid="LocalUrl"
						 x:Name="TextBoxUrl"
						 Margin="0,0,12,12"
						 Text="{Binding Url, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
					<Interactivity:Interaction.Behaviors>
						<Core:EventTriggerBehavior EventName="LostFocus">
							<Core:InvokeCommandAction Command="{Binding Path=UrlCheckCommand, Mode=TwoWay}"
													  CommandParameter="{Binding ElementName=TextBoxUrl,Path=Text}" />
						</Core:EventTriggerBehavior>
					</Interactivity:Interaction.Behaviors>
				</TextBox>
				<TextBlock x:Uid="UsernameHeader" />
				<TextBox x:Name="TextBoxUsername"
						 Margin="0,0,12,12"
						 Text="{Binding Username, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
						 TextWrapping="Wrap">
					<Interactivity:Interaction.Behaviors>
						<Core:EventTriggerBehavior EventName="LostFocus">
							<Core:InvokeCommandAction Command="{Binding Path=UrlCheckCommand, Mode=TwoWay}"
													  CommandParameter="{Binding ElementName=TextBoxUrl,Path=Text}" />
						</Core:EventTriggerBehavior>
					</Interactivity:Interaction.Behaviors>
				</TextBox>
				<TextBlock x:Uid="PasswordHeader" />
				<PasswordBox x:Name="TextBoxPassword"
							 Margin="0,0,12,12"
							 Password="{Binding Password, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
					<Interactivity:Interaction.Behaviors>
						<Core:EventTriggerBehavior EventName="LostFocus">
							<Core:InvokeCommandAction Command="{Binding Path=LocalUrlCheckCommand, Mode=TwoWay}"
													  CommandParameter="{Binding ElementName=TextBoxUrl,Path=Text}" />
						</Core:EventTriggerBehavior>
					</Interactivity:Interaction.Behaviors>
				</PasswordBox>
				<TextBlock x:Uid="IgnoreSSLCertErrors" />
				<CheckBox x:Name="CheckBoxIgnoreSSL"
						  Margin="0,0,0,12"
						  HorizontalAlignment="Stretch"
						  VerticalAlignment="Stretch"
						  IsChecked="{Binding WillIgnoreSSLCertificate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
				<TextBlock x:Uid="IgnoreSSLCertHostErrors" />
				<CheckBox x:Name="CheckBoxIgnoreSSLHostname"
						  Margin="0,0,0,12"
						  HorizontalAlignment="Stretch"
						  VerticalAlignment="Stretch"
						  IsChecked="{Binding WillIgnoreSSLHostname, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
				<StackPanel Orientation="Horizontal">
					<TextBlock x:Uid="ConnectionCheck"
							   Margin="0,0,10,0"
							   VerticalAlignment="Center" />
					<FontIcon x:Name="IconUrlStatusCheck"
							  VerticalAlignment="Top"
							  FontSize="32"
							  FontFamily="{StaticResource SymbolThemeFontFamily}"
							  Glyph="{Binding UrlState, Converter={StaticResource OpenHabUrlStateToGlyph}, Mode=TwoWay}" />
				</StackPanel>
			</StackPanel>
		</DataTemplate>
	</Page.Resources>

	<ScrollViewer Grid.Row="1"
				  VerticalScrollBarVisibility="Auto">
		<Grid Margin="16">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="Auto" />
			</Grid.RowDefinitions>
			<TextBlock x:Uid="SettingsHeader"
					   x:Name="SettingsTitle"
					   Margin="0,6,0,6"
					   HorizontalAlignment="Left"
					   VerticalAlignment="Center"
					   Foreground="White"
					   FontSize="32"
					   TextWrapping="Wrap" />

			<StackPanel Orientation="Vertical">

				<StackPanel Margin="0,0,0,25"
							Padding="12"
							Background="{ThemeResource OpenHABLightColor}">
					<TextBlock x:Uid="AppSettings"
							   Style="{StaticResource TitleTextBlockStyle}"
							   Margin="0,0,0,10" />
					<TextBlock x:Uid="HideDefaultSitemap"
							   Margin="0,0,0,10" />
					<ToggleSwitch x:Name="CheckBoxHideDefaultSitemap"
								  Margin="0,0,0,12"
								  HorizontalAlignment="Stretch"
								  VerticalAlignment="Stretch"
								  IsOn="{Binding Settings.HideDefaultSitemap, Mode=TwoWay}" />
					<TextBlock x:Uid="AppLanguage"
							   Margin="0,0,0,10" />
					<ComboBox Margin="0,0,0,12"
							  ItemsSource="{Binding Settings.AppLanguages}"
							  DisplayMemberPath="Name"
							  SelectedItem="{Binding Settings.SelectedAppLanguage, Mode=TwoWay}" />
				</StackPanel>

				<!-- Connection Settings -->
				<Grid Padding="12"
					  Background="{ThemeResource OpenHABLightColor}">
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
					</Grid.RowDefinitions>
					<StackPanel Grid.Row="0">
						<TextBlock x:Uid="ConnectionSettings"
								   Style="{StaticResource TitleTextBlockStyle}"
								   Margin="0,0,0,10" />
						<TextBlock x:Uid="DemoModeHeader" />
						<ToggleSwitch x:Name="CheckBoxDemoMode"
									  Margin="0,0,0,12"
									  HorizontalAlignment="Stretch"
									  VerticalAlignment="Stretch"
									  IsOn="{Binding Settings.IsRunningInDemoMode, Mode=TwoWay}" />
					</StackPanel>
					<StackPanel Grid.Row="1">
						<Button Margin="10"
								HorizontalAlignment="Stretch"
								VerticalAlignment="Stretch"
								HorizontalContentAlignment="Left"
								DataContext="{Binding Path=Settings.LocalConnection}"
								IsEnabled="{x:Bind CheckBoxDemoMode.IsOn, Converter={StaticResource ReverseBoolConverter}, Mode=OneWay}"
								Click="OpenLocalConnectionButton_Click">
							<StackPanel HorizontalAlignment="Left">
								<TextBlock x:Uid="LocalSettings"
										   FontSize="16" />
								<TextBlock Text="{Binding Subtitle}" />
							</StackPanel>
						</Button>
						<Button Margin="10"
								HorizontalAlignment="Stretch"
								VerticalAlignment="Stretch"
								HorizontalContentAlignment="Left"
								DataContext="{Binding Path=Settings.RemoteConnection}"
								IsEnabled="{x:Bind CheckBoxDemoMode.IsOn, Converter={StaticResource ReverseBoolConverter}, Mode=OneWay}"
								Click="OpenRemoteConnectionButton_Click">
							<StackPanel>
								<TextBlock x:Uid="RemoteSettings"
										   FontSize="16" />
								<TextBlock Text="{Binding Subtitle}" />
							</StackPanel>
						</Button>
					</StackPanel>
				</Grid>
				<Grid Margin="0,25,0,0"
					  Padding="12"
					  Background="{ThemeResource OpenHABLightColor}">
					<Grid.ColumnDefinitions>
						<ColumnDefinition />
						<ColumnDefinition />
					</Grid.ColumnDefinitions>
					<StackPanel Grid.Column="0"
								VerticalAlignment="Center"
								Orientation="Horizontal">
						<TextBlock x:Uid="AppVersion" />
						<TextBlock Margin="10,0,0,0"
								   Text="{Binding Path=Version}" />
					</StackPanel>
					<StackPanel Grid.Column="1"
								HorizontalAlignment="Right"
								Orientation="Horizontal">
						<Button x:Uid="SaveButton"
								Margin="0,0,8,0"
								Command="{x:Bind Vm.SaveCommand}"
								Click="Button_OnClick" />
						<Button x:Uid="CancelButton"
								Click="Button_OnClick" />
					</StackPanel>
				</Grid>
			</StackPanel>

			<community:InAppNotification x:Name="SettingsNotification"
										 Grid.Row="1"
										 Grid.RowSpan="2"
										 Background="{StaticResource ErrorNotificationBackground}"
										 ShowDismissButton="True"
										 AnimationDuration="00:00:00.1000000"
										 VerticalOffset="100"
										 HorizontalOffset="0"
										 StackMode="StackInFront" />

			<ContentDialog x:Uid="ConnectionDialog"
						   x:Name="ConnectionDialog"
						   PrimaryButtonText="Close"
						   DefaultButton="Primary"
						   ContentTemplate="{StaticResource ConnectionConfigTemplate}" />
		</Grid>
	</ScrollViewer>
</Page>